<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Qt Toolkit - fileiconview/main.cpp example file
</title><style type="text/css"><!--
h3.fn,span.fn { margin-left: 1cm; text-indent: -1cm; }
a:link { color: #004faf; text-decoration: none }
a:visited { color: #672967; text-decoration: none }body { background: white; color: black; }
--></style>
</head><body bgcolor="#ffffff">

<table width="100%">
<tr><td><a href="index.html">
<img width="100" height="100" src="qtlogo.png"
alt="Home" border="0"><img width="100"
height="100" src="face.png" alt="Home" border="0">
</a><td valign=top><div align=right><img src="dochead.png" width="472" height="27"><br>
<a href="classes.html"><b>Classes</b></a>
- <a href="annotated.html">Annotated</a>
- <a href="hierarchy.html">Tree</a>
- <a href="functions.html">Functions</a>
- <a href="index.html">Home</a>
- <a href="topicals.html"><b>Structure</b></a>
</div>
</table>

<h1 align=center>Simple Filemanager</h1><br clear="all">

  This example implements a simple and not full functional file manager using
  a widget derived from QIconView to display the current directory and the
  widget of the DirectoryView example to display the directory tree.

  <hr>

  Header file of the fileiconview: <pre>/****************************************************************************
** &#36;Id&#58; qt/examples/fileiconview/qfileiconview.h   2.3.2   edited 2001-01-26 $
**
** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.
**
** This file is part of an example program for Qt.  This example
** program may be used, distributed and modified without limitation.
**
*****************************************************************************/

#ifndef QTFILEICONVIEW_H
#define QTFILEICONVIEW_H

#include &lt;<a href="qiconset-h.html">qiconset.h</a>&gt;
#include &lt;<a href="qstring-h.html">qstring.h</a>&gt;
#include &lt;<a href="qfileinfo-h.html">qfileinfo.h</a>&gt;
#include &lt;<a href="qdir-h.html">qdir.h</a>&gt;
#include &lt;<a href="qtimer-h.html">qtimer.h</a>&gt;
#include &lt;<a href="qiconview-h.html">qiconview.h</a>&gt;

class QtFileIconView;
class QDragObject;
class QResizeEvent;

/*****************************************************************************
 *
 * Class QtFileIconDrag
 *
 *****************************************************************************/

class QtFileIconDrag : public QIconDrag
{
    Q_OBJECT

public:
    QtFileIconDrag( <a href="qwidget.html">QWidget</a> * dragSource, const char* name = 0 );

    const char* format( int i ) const;
    <a href="qbytearray.html">QByteArray</a> encodedData( const char* mime ) const;
    static bool canDecode( <a href="qmimesource.html">QMimeSource</a>* e );
    void append( const QIconDragItem &amp;item, const QRect &amp;pr, const QRect &amp;tr, const QString &amp;url );

private:
    <a href="qstringlist.html">QStringList</a> urls;

};

/*****************************************************************************
 *
 * Class QtFileIconView
 *
 *****************************************************************************/
class QtFileIconViewItem;
class QtFileIconView : public QIconView
{
    Q_OBJECT

public:
    QtFileIconView( const QString &amp;dir, QWidget *parent = 0, const char *name = 0 );

    enum ViewMode { Large, Small };

    void setViewMode( ViewMode m );
    ViewMode viewMode() const { return vm; }
    void setOpenItem( QtFileIconViewItem *i ) {
        openItem = i;
    }

public slots:
    void setDirectory( const QString &amp;dir );
    void setDirectory( const QDir &amp;dir );
    void newDirectory();
    <a href="qdir.html">QDir</a> currentDir();

signals:
    void directoryChanged( const QString &amp; );
    void startReadDir( int dirs );
    void readNextDir();
    void readDirDone();
    void enableUp();
    void disableUp();
    void enableMkdir();
    void disableMkdir();

protected slots:
    void itemDoubleClicked( <a href="qiconviewitem.html">QIconViewItem</a> *i );
    void slotDropped( <a href="qdropevent.html">QDropEvent</a> *e, const QValueList&lt;<a href="qicondragitem.html">QIconDragItem</a>&gt; &amp; );

    void viewLarge();
    void viewSmall();
    void viewBottom();
    void viewRight();
    void flowEast();
    void flowSouth();
    void itemTextTruncate();
    void itemTextWordWrap();
    void sortAscending();
    void sortDescending();
    void arrangeItemsInGrid() {
        <a href="qiconview.html#9fb7be">QIconView::arrangeItemsInGrid</a>( TRUE );
    }

    void slotRightPressed( <a href="qiconviewitem.html">QIconViewItem</a> *item );
    void openFolder();

protected:
    void readDir( const QDir &amp;dir );
    virtual QDragObject *dragObject();

    virtual void keyPressEvent( <a href="qkeyevent.html">QKeyEvent</a> *e );

    <a href="qdir.html">QDir</a> viewDir;
    int newFolderNum;
    <a href="qsize.html">QSize</a> sz;
    <a href="qpixmap.html">QPixmap</a> pix;
    ViewMode vm;
    QtFileIconViewItem *openItem;

};

/*****************************************************************************
 *
 * Class QtFileIconViewItem
 *
 *****************************************************************************/

class QtFileIconViewItem : public QIconViewItem
{
    friend class QtFileIconView;

public:
    enum ItemType {
        File = 0,
        Dir,
        Link
    };

    QtFileIconViewItem( QtFileIconView *parent, QFileInfo *fi );

    virtual ~QtFileIconViewItem();

    ItemType type() const
    { return itemType; }
    <a href="qstring.html">QString</a> filename() const { return itemFileName; }

    virtual bool acceptDrop( const QMimeSource *e ) const;

    virtual void setText( const QString &amp;text );
    virtual QPixmap *pixmap() const;

    virtual void dragEntered();
    virtual void dragLeft();

    void viewModeChanged( QtFileIconView::ViewMode m );
    void paintItem( <a href="qpainter.html">QPainter</a> *p, const QColorGroup &amp;cg );

protected:
    virtual void dropped( <a href="qdropevent.html">QDropEvent</a> *e, const QValueList&lt;<a href="qicondragitem.html">QIconDragItem</a>&gt; &amp; );

    <a href="qstring.html">QString</a> itemFileName;
    <a href="qfileinfo.html">QFileInfo</a> *itemFileInfo;
    ItemType itemType;
    bool checkSetText;
    <a href="qtimer.html">QTimer</a> timer;
    QtFileIconView::ViewMode vm;

};

#endif
</pre>


  <hr>

  Implementation of the fileiconview: <pre>/****************************************************************************
** &#36;Id&#58; qt/examples/fileiconview/qfileiconview.cpp   2.3.2   edited 2001-10-17 $
**
** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.
**
** This file is part of an example program for Qt.  This example
** program may be used, distributed and modified without limitation.
**
*****************************************************************************/

#include "qfileiconview.h"

#include &lt;<a href="qstringlist-h.html">qstringlist.h</a>&gt;
#include &lt;<a href="qpixmap-h.html">qpixmap.h</a>&gt;
#include &lt;<a href="qmime-h.html">qmime.h</a>&gt;
#include &lt;<a href="qstrlist-h.html">qstrlist.h</a>&gt;
#include &lt;<a href="qdragobject-h.html">qdragobject.h</a>&gt;
#include &lt;<a href="qmessagebox-h.html">qmessagebox.h</a>&gt;
#include &lt;<a href="qevent-h.html">qevent.h</a>&gt;
#include &lt;<a href="qpopupmenu-h.html">qpopupmenu.h</a>&gt;
#include &lt;<a href="qcursor-h.html">qcursor.h</a>&gt;
#include &lt;<a href="qapplication-h.html">qapplication.h</a>&gt;
#include &lt;<a href="qwmatrix-h.html">qwmatrix.h</a>&gt;

#include &lt;stdlib.h&gt;

static const char * file_icon[]={
    "32 32 17 1",
    "# c #000000",
    "a c #ffffff",
    "j c #808080",
    "n c #a0a0a4",
    "g c #c0c0c0",
    "m c #004000",
    "o c #000000",
    "l c #004040",
    "k c #404000",
    "i c #c0c000",
    "h c #ffff00",
    "b c #ffffc0",
    "e c #ff8000",
    "f c #c05800",
    "c c #ffa858",
    "d c #ffdca8",
    ". c None",
    "................................",
    "................................",
    "................................",
    "................................",
    ".............#....###...........",
    "...###......#a##.#aba##.........",
    "..#cdb#....#aaaa#aaaaaa##.......",
    "..#ecdb#..#aaaa#aaaaaaaba##.....",
    "..#fecdb##aaaa#aaaaaaaaaaab##...",
    "...#fecdb#aaa#aaaaaaabaabaaaa##.",
    "....#fecdb#a#baaaaa#baaaaaabaaa#",
    ".....#fecdb#aaaaab#a##baaaaaaa#.",
    ".....##fecdb#bbba#aaaa##baaab#..",
    "....#bb#fecdb#ba#aaaaaaa##aa#...",
    "...#bbbb#fecdb##aaabaaaaaa##....",
    "..#bbbb#b#fecdb#aaaaaaabaaaa##..",
    ".#bbbb#bbb#fecdg#aaaaaaaaaaaba#.",
    "#hhbb#bbbbb#fegg#iiaaaaaaaaaaaa#",
    "#jhhhklibbbk#ggj#aaiiaaaaaaaaa#j",
    ".#mjhhhkmikab####aaabiiaaaaaa#j.",
    "...##jhhhmaaibbaaiibaaaiiaab#n..",
    ".....##j#baaaiiabaaiibaabaa#n...",
    "......##baibaabiibaaaiiabb#j....",
    "......#bbbbiiaabbiiaaaaabon.....",
    ".....#bbbbbbbiiabbaiiaab#n......",
    ".....#jbbbbbbbbiibaabba#n.......",
    "......##jbbbbbbbbiiaabmj........",
    "........##jbbbbbbbbbb#j.........",
    "..........##nbbbbbbbmj..........",
    "............##jbbbb#j...........",
    "..............#mjj#n............",
    "................##n............."};

static const char * folder_icon[]={
    "32 32 11 1",
    "# c #000000",
    "b c #c0c000",
    "d c #585858",
    "a c #ffff00",
    "i c #400000",
    "h c #a0a0a4",
    "e c #000000",
    "c c #ffffff",
    "f c #303030",
    "g c #c0c0c0",
    ". c None",
    "...###..........................",
    "...#aa##........................",
    ".###baaa##......................",
    ".#cde#baaa##....................",
    ".#cccdeebaaa##..##f.............",
    ".#cccccdeebaaa##aaa##...........",
    ".#cccccccdeebaaaaaaaa##.........",
    ".#cccccccccdeebababaaa#.........",
    ".#cccccgcgghhebbbbbbbaa#........",
    ".#ccccccgcgggdebbbbbbba#........",
    ".#cccgcgcgcgghdeebiebbba#.......",
    ".#ccccgcggggggghdeddeeba#.......",
    ".#cgcgcgcggggggggghghdebb#......",
    ".#ccgcggggggggghghghghd#b#......",
    ".#cgcgcggggggggghghghhd#b#......",
    ".#gcggggggggghghghhhhhd#b#......",
    ".#cgcggggggggghghghhhhd#b#......",
    ".#ggggggggghghghhhhhhhdib#......",
    ".#gggggggggghghghhhhhhd#b#......",
    ".#hhggggghghghhhhhhhhhd#b#......",
    ".#ddhhgggghghghhhhhhhhd#b#......",
    "..##ddhhghghhhhhhhhhhhdeb#......",
    "....##ddhhhghhhhhhhhhhd#b#......",
    "......##ddhhhhhhhhhhhhd#b#......",
    "........##ddhhhhhhhhhhd#b#......",
    "..........##ddhhhhhhhhd#b#......",
    "............##ddhhhhhhd#b###....",
    "..............##ddhhhhd#b#####..",
    "................##ddhhd#b######.",
    "..................##dddeb#####..",
    "....................##d#b###....",
    "......................####......"};

static const char * link_icon[]={
    "32 32 12 1",
    "# c #000000",
    "h c #a0a0a4",
    "b c #c00000",
    "d c #585858",
    "i c #400000",
    "c c #ffffff",
    "e c #000000",
    "g c #c0c0c0",
    "a c #ff0000",
    "f c #303030",
    "n c white",
    ". c None",
    "...###..........................",
    "...#aa##........................",
    ".###baaa##......................",
    ".#cde#baaa##....................",
    ".#cccdeebaaa##..##f.............",
    ".#cccccdeebaaa##aaa##...........",
    ".#cccccccdeebaaaaaaaa##.........",
    ".#cccccccccdeebababaaa#.........",
    ".#cccccgcgghhebbbbbbbaa#........",
    ".#ccccccgcgggdebbbbbbba#........",
    ".#cccgcgcgcgghdeebiebbba#.......",
    ".#ccccgcggggggghdeddeeba#.......",
    ".#cgcgcgcggggggggghghdebb#......",
    ".#ccgcggggggggghghghghd#b#......",
    ".#cgcgcggggggggghghghhd#b#......",
    ".#gcggggggggghghghhhhhd#b#......",
    ".#cgcggggggggghghghhhhd#b#......",
    ".#ggggggggghghghhhhhhhdib#......",
    ".#gggggggggghghghhhhhhd#b#......",
    ".#hhggggghghghhhhhhhhhd#b#......",
    ".#ddhhgggghghghhhhhhhhd#b#......",
    "..##ddhhghghhhhhhhhhhhdeb#......",
    "############hhhhhhhhhhd#b#......",
    "#nnnnnnnnnn#hhhhhhhhhhd#b#......",
    "#nnnnnnnnnn#hhhhhhhhhhd#b#......",
    "#nn#nn#nnnn#ddhhhhhhhhd#b#......",
    "#nn##n##nnn###ddhhhhhhd#b###....",
    "#nnn#####nn#..##ddhhhhd#b#####..",
    "#nnnnn##nnn#....##ddhhd#b######.",
    "#nnnnn#nnnn#......##dddeb#####..",
    "#nnnnnnnnnn#........##d#b###....",
    "############..........####......"};

static const char * folder_locked_icon[]={
    "32 32 12 1",
    "# c #000000",
    "g c #808080",
    "h c #c0c0c0",
    "f c #c05800",
    "c c #ffffff",
    "d c #585858",
    "b c #ffa858",
    "a c #ffdca8",
    "e c #000000",
    "i c #a0a0a4",
    "j c #c0c0c0",
    ". c None",
    "...###..........................",
    "...#aa##........................",
    ".###baaa##......................",
    ".#cde#baaa##....................",
    ".#cccdeeba#######...............",
    ".#cccccde##fffff##..............",
    ".#cccccc##fffgggg#..............",
    ".#ccccccc#ffg####a##............",
    ".#ccccchc#ffg#eebbaa##..........",
    ".#ccccccc#ffg#ddeebbba##........",
    ".#ccchccc#ffg#ihddeebbba##......",
    ".#cccccaa#ffg#ihhhddeeba##......",
    ".#chchhbbaafg#ihhhihidebb#......",
    ".#cchccbbbbaa#ihhihihid#b#......",
    ".#chchhbb#bbbaaiihihiid#b#......",
    ".#hchhcbb#fbbbafhiiiiid#b#......",
    ".#chchhbb#ffgbbfihiiiid#b#......",
    ".#hhhhhbb#ffg#bfiiiiiid#b#......",
    ".#hhhhhbbaffg#bfiiiiiid#b#......",
    ".#iihhhjbbaab#bfiiiiiid#b#......",
    ".#ddiihhh#bbbabfiiiiiid#b#......",
    "..##ddiih#ffbbbfiiiiiid#b#......",
    "....##ddi#ffg#biiiiiiid#b#......",
    "......##d#ffg#iiiiiiiid#b#......",
    "........##ffg#iiiiiiiid#b#......",
    ".........#ffg#iiiiiiiid#b#......",
    ".........#ffg#ddiiiiiid#b###....",
    ".........##fg###ddiiiid#b#####..",
    "...........####.##ddiid#b######.",
    "..................##dddeb#####..",
    "....................##d#b###....",
    "......................####......"};

static QPixmap *iconFolderLockedLarge = 0;
static QPixmap *iconFolderLarge = 0;
static QPixmap *iconFileLarge = 0;
static QPixmap *iconLinkLarge = 0;
static QPixmap *iconFolderLockedSmall = 0;
static QPixmap *iconFolderSmall = 0;
static QPixmap *iconFileSmall = 0;
static QPixmap *iconLinkSmall = 0;

static void cleanup()
{
    delete iconFolderLockedLarge;
    iconFolderLockedLarge = 0;
    delete iconFolderLarge;
    iconFolderLarge = 0;
    delete iconFileLarge;
    iconFileLarge = 0;
    delete iconLinkLarge;
    iconLinkLarge = 0;
    delete iconFolderLockedSmall;
    iconFolderLockedSmall = 0;
    delete iconFolderSmall;
    iconFolderSmall = 0;
    delete iconFileSmall;
    iconFileSmall = 0;
    delete iconLinkSmall;
    iconLinkSmall = 0;
}

/*****************************************************************************
 *
 * Class QtFileIconDrag
 *
 *****************************************************************************/

QtFileIconDrag::QtFileIconDrag( <a href="qwidget.html">QWidget</a> * dragSource, const char* name )
    : <a href="qicondrag.html">QIconDrag</a>( dragSource, name )
{
}

const char* <a name="236"></a>QtFileIconDrag::format( int i ) const
{
    if ( i == 0 )
        return "application/x-qiconlist";
    else if ( i == 1 )
        return "text/uri-list";
    else
        return 0;
}

<a href="qbytearray.html">QByteArray</a> <a name="237"></a>QtFileIconDrag::encodedData( const char* mime ) const
{
    <a href="qbytearray.html">QByteArray</a> a;
    if ( <a href="qstring.html">QString</a>( mime ) == "application/x-qiconlist" ) {
        a = QIconDrag::encodedData( mime );
    } else if ( <a href="qstring.html">QString</a>( mime ) == "text/uri-list" ) {
        <a href="qstring.html">QString</a> s = urls.join( "\r\n" );
        a.<a href="qbytearray.html#191333">resize</a>( s.<a href="qstring.html#0ecbda">length</a>() );
        memcpy( a.<a href="qbytearray.html#2733f4">data</a>(), s.<a href="qstring.html#ea8169">latin1</a>(), s.<a href="qstring.html#0ecbda">length</a>() );
    }
    return a;
}

bool <a name="238"></a>QtFileIconDrag::canDecode( <a href="qmimesource.html">QMimeSource</a>* e )
{
    return e-&gt;<a href="qdropevent.html#e9bf16">provides</a>( "application/x-qiconlist" ) ||
        e-&gt;<a href="qdropevent.html#e9bf16">provides</a>( "text/uri-list" );
}

void <a name="239"></a>QtFileIconDrag::append( const QIconDragItem &amp;item, const QRect &amp;pr,
                             const QRect &amp;tr, const QString &amp;url )
{
    <a href="qicondrag.html#e2f3cc">QIconDrag::append</a>( item, pr, tr );
    urls &lt;&lt; url;
}

/*****************************************************************************
 *
 * Class QtFileIconViewItem
 *
 *****************************************************************************/

QtFileIconViewItem::QtFileIconViewItem( QtFileIconView *parent, QFileInfo *fi )
    : <a href="qiconviewitem.html">QIconViewItem</a>( parent, fi-&gt;<a href="qfileinfo.html#a9e3d2">fileName</a>() ), itemFileName( fi-&gt;<a href="qfileinfo.html#ebb5a0">filePath</a>() ),
      itemFileInfo( fi ), checkSetText( FALSE )
{
    vm = QtFileIconView::Large;

    if ( itemFileInfo-&gt;isDir() )
        itemType = Dir;
    else if ( itemFileInfo-&gt;isFile() )
        itemType = File;
    if ( itemFileInfo-&gt;isSymLink() )
        itemType = Link;

    <a href=#207>viewModeChanged</a>( ( (QtFileIconView*)iconView() )-&gt;viewMode() );

    if ( itemFileInfo-&gt;fileName() == "." ||
         itemFileInfo-&gt;fileName() == ".." )
        <a href="qiconviewitem.html#2eb423">setRenameEnabled</a>( FALSE );

    checkSetText = TRUE;

    <a href="qobject.html#7f8e37">QObject::connect</a>( &amp;timer, SIGNAL( timeout() ),
                      <a href="qiconviewitem.html#cc030e">iconView</a>(), SLOT( openFolder() ) );
}

void <a name="206"></a>QtFileIconViewItem::paintItem( <a href="qpainter.html">QPainter</a> *p, const QColorGroup &amp;cg )
{
    if ( itemFileInfo-&gt;isSymLink() ) {
        <a href="qfont.html">QFont</a> f( p-&gt;font() );
        f.<a href="qfont.html#b6af25">setItalic</a>( TRUE );
        p-&gt;setFont( f );
    }

    <a href="qiconviewitem.html#9f712d">QIconViewItem::paintItem</a>( p, cg );
}

void <a name="207"></a>QtFileIconViewItem::viewModeChanged( QtFileIconView::ViewMode m )
{
    vm = m;
    <a href="qiconviewitem.html#015768">setDropEnabled</a>( itemType == Dir &amp;&amp; <a href="qdir.html">QDir</a>( itemFileName ).isReadable() );
    <a href="qiconviewitem.html#c2e4a4">calcRect</a>();
}

<a href="qpixmap.html">QPixmap</a> *<a name="208"></a>QtFileIconViewItem::pixmap() const
{
    switch ( itemType ) {
    case Dir: {
        if ( !QDir( itemFileName ).isReadable() ) {
            if ( vm == QtFileIconView::Small )
                return iconFolderLockedSmall;
            else
                return iconFolderLockedLarge;
        } else {
            if ( vm == QtFileIconView::Small )
                return iconFolderSmall;
            else
                return iconFolderLarge;
        }
    }
    case Link: {
            if ( vm == QtFileIconView::Small )
                return iconLinkSmall;
            else
                return iconLinkLarge;
    }
    default: {
            if ( vm == QtFileIconView::Small )
                return iconFileSmall;
            else
                return iconFileLarge;
    }
    }
}

QtFileIconViewItem::~QtFileIconViewItem()
{
    delete itemFileInfo;
}

void <a name="209"></a>QtFileIconViewItem::setText( const QString &amp;text )
{
    if ( checkSetText ) {
        if ( text == "." || text == "." || text.isEmpty() )
            return;
        <a href="qdir.html">QDir</a> dir( itemFileInfo-&gt;dir() );
        if ( dir.<a href="qdir.html#a7d8c0">rename</a>( itemFileInfo-&gt;fileName(), text ) ) {
            itemFileName = itemFileInfo-&gt;dirPath( TRUE ) + "/" + text;
            delete itemFileInfo;
            itemFileInfo = new <a href="qfileinfo.html">QFileInfo</a>( itemFileName );
            <a href="qiconviewitem.html#3ecbc5">QIconViewItem::setText</a>( text );
        }
    } else {
        <a href="qiconviewitem.html#3ecbc5">QIconViewItem::setText</a>( text );
    }
}

bool <a name="210"></a>QtFileIconViewItem::acceptDrop( const QMimeSource *e ) const
{
    if ( type() == Dir &amp;&amp; e-&gt;<a href="qdropevent.html#e9bf16">provides</a>( "text/uri-list" ) &amp;&amp;
         <a href="qiconviewitem.html#eca4f0">dropEnabled</a>() )
        return TRUE;

    return FALSE;
}

void <a name="211"></a>QtFileIconViewItem::dropped( <a href="qdropevent.html">QDropEvent</a> *e, const QValueList&lt;<a href="qicondragitem.html">QIconDragItem</a>&gt; &amp; )
{
    timer.stop();

    if ( !QUriDrag::canDecode( e ) ) {
        e-&gt;<a href="qdropevent.html#e7a50f">ignore</a>();
        return;
    }

    <a href="qstrlist.html">QStrList</a> lst;
    <a href="quridrag.html#e14cb1">QUriDrag::decode</a>( e, lst );

    <a href="qstring.html">QString</a> str;
    if ( e-&gt;<a href="qdropevent.html#d9f8b7">action</a>() == QDropEvent::Copy )
        str = "Copy\n\n";
    else
        str = "Move\n\n";
    for ( uint i = 0; i &lt; lst.<a href="qlist.html#359d9f">count</a>(); ++i )
        str += QString( "   %1\n" ).arg( lst.<a href="qlist.html#1cdd9a">at</a>( i ) );
    str += QString( "\n"
                    "To\n\n"
                    "   %1" ).arg( filename() );

    <a href="qmessagebox.html#66b7c8">QMessageBox::information</a>( <a href="qiconviewitem.html#cc030e">iconView</a>(), e-&gt;<a href="qdropevent.html#d9f8b7">action</a>() == QDropEvent::Copy ? "Copy" : "Move" , str, "Not Implemented" );
    if ( e-&gt;<a href="qdropevent.html#d9f8b7">action</a>() == QDropEvent::Move )
        <a href="qmessagebox.html#66b7c8">QMessageBox::information</a>( <a href="qiconviewitem.html#cc030e">iconView</a>(), "Remove" , str, "Not Implemented" );
    e-&gt;<a href="qdropevent.html#d37a0e">acceptAction</a>();
}

void <a name="212"></a>QtFileIconViewItem::dragEntered()
{
    if ( type() != Dir ||
         type() == Dir &amp;&amp; !QDir( itemFileName ).isReadable() )
        return;

    ( (QtFileIconView*)iconView() )-&gt;setOpenItem( this );
    timer.start( 1500 );
}

void <a name="213"></a>QtFileIconViewItem::dragLeft()
{
    if ( type() != Dir ||
         type() == Dir &amp;&amp; !QDir( itemFileName ).isReadable() )
        return;

    timer.stop();
}

/*****************************************************************************
 *
 * Class QtFileIconView
 *
 *****************************************************************************/

QtFileIconView::QtFileIconView( const QString &amp;dir, QWidget *parent, const char *name )
    : <a href="qiconview.html">QIconView</a>( parent, name ), viewDir( dir ), newFolderNum( 0 )
{
    if ( !iconFolderLockedLarge ) {
        <a href="qapplication.html#6382b3">qAddPostRoutine</a>( cleanup );
        <a href="qwmatrix.html">QWMatrix</a> m;
        m.<a href="qwmatrix.html#41a356">scale</a>( 0.6, 0.6 );
        <a href="qpixmap.html">QPixmap</a> iconpix( folder_locked_icon );
        iconFolderLockedLarge = new <a href="qpixmap.html">QPixmap</a>( folder_locked_icon );
        iconpix = iconpix.<a href="qpixmap.html#ff5fcf">xForm</a>( m );
        iconFolderLockedSmall = new <a href="qpixmap.html">QPixmap</a>( iconpix );
        iconpix = QPixmap( folder_icon );
        iconFolderLarge = new <a href="qpixmap.html">QPixmap</a>( folder_icon );
        iconpix = iconpix.<a href="qpixmap.html#ff5fcf">xForm</a>( m );
        iconFolderSmall = new <a href="qpixmap.html">QPixmap</a>( iconpix );
        iconpix = QPixmap( file_icon );
        iconFileLarge = new <a href="qpixmap.html">QPixmap</a>( file_icon );
        iconpix = iconpix.<a href="qpixmap.html#ff5fcf">xForm</a>( m );
        iconFileSmall = new <a href="qpixmap.html">QPixmap</a>( iconpix );
        iconpix = QPixmap( link_icon );
        iconLinkLarge = new <a href="qpixmap.html">QPixmap</a>( link_icon );
        iconpix = iconpix.<a href="qpixmap.html#ff5fcf">xForm</a>( m );
        iconLinkSmall = new <a href="qpixmap.html">QPixmap</a>( iconpix );
    }

    vm = Large;

    setGridX( 75 );
    setResizeMode( Adjust );
    setWordWrapIconText( FALSE );

    connect( this, SIGNAL( doubleClicked( <a href="qiconviewitem.html">QIconViewItem</a> * ) ),
             this, SLOT( itemDoubleClicked( <a href="qiconviewitem.html">QIconViewItem</a> * ) ) );
    connect( this, SIGNAL( returnPressed( <a href="qiconviewitem.html">QIconViewItem</a> * ) ),
             this, SLOT( itemDoubleClicked( <a href="qiconviewitem.html">QIconViewItem</a> * ) ) );
    connect( this, SIGNAL( <a href=#211>dropped</a>( <a href="qdropevent.html">QDropEvent</a> *, const QValueList&lt;<a href="qicondragitem.html">QIconDragItem</a>&gt; &amp; ) ),
             this, SLOT( slotDropped( <a href="qdropevent.html">QDropEvent</a> *, const QValueList&lt;<a href="qicondragitem.html">QIconDragItem</a>&gt; &amp; ) ) );
    connect( this, SIGNAL( rightButtonPressed( <a href="qiconviewitem.html">QIconViewItem</a> *, const QPoint &amp; ) ),
             this, SLOT( slotRightPressed( <a href="qiconviewitem.html">QIconViewItem</a> * ) ) );

    setHScrollBarMode( AlwaysOff );
    setVScrollBarMode( Auto );

    setAutoArrange( TRUE );
    setSorting( TRUE );
    openItem = 0;
}

void <a name="214"></a>QtFileIconView::openFolder()
{
    if ( !openItem )
        return;
    if ( openItem-&gt;type() != QtFileIconViewItem::Dir ||
         openItem-&gt;type() == QtFileIconViewItem::Dir &amp;&amp;
         !QDir( openItem-&gt;itemFileName ).isReadable() )
        return;

    openItem-&gt;timer.stop();
    <a href=#216>setDirectory</a>( openItem-&gt;itemFileName );
}

void <a name="216"></a>QtFileIconView::setDirectory( const QString &amp;dir )
{
    viewDir = QDir( dir );
    <a href=#219>readDir</a>( viewDir );
}

void <a name="216"></a>QtFileIconView::setDirectory( const QDir &amp;dir )
{
    viewDir = dir;
    <a href=#219>readDir</a>( viewDir );
}

void <a name="217"></a>QtFileIconView::newDirectory()
{
    <a href="qiconview.html#7b3f0b">setAutoArrange</a>( FALSE );
    <a href="qiconview.html#31b5ce">selectAll</a>( FALSE );
    if ( viewDir.mkdir( <a href="qstring.html">QString</a>( "New Folder %1" ).arg( ++newFolderNum ) ) ) {
        <a href="qfileinfo.html">QFileInfo</a> *fi = new <a href="qfileinfo.html">QFileInfo</a>( viewDir, QString( "New Folder %1" ).arg( newFolderNum ) );
        QtFileIconViewItem *item = new QtFileIconViewItem( this, new <a href="qfileinfo.html">QFileInfo</a>( *fi ) );
        item-&gt;<a href="qiconviewitem.html#4782f9">setKey</a>( <a href="qstring.html">QString</a>( "000000%1" ).arg( fi-&gt;<a href="qfileinfo.html#a9e3d2">fileName</a>() ) );
        delete fi;
        <a href="qscrollview.html#e63ced">repaintContents</a>( contentsX(), <a href="qscrollview.html#459550">contentsY</a>(), <a href="qscrollview.html#96e59b">contentsWidth</a>(), <a href="qscrollview.html#b016d7">contentsHeight</a>(), FALSE );
        <a href="qiconview.html#76c81f">ensureItemVisible</a>( item );
        item-&gt;<a href="qiconviewitem.html#44f4f6">setSelected</a>( TRUE, TRUE );
        <a href="qiconview.html#b30724">setCurrentItem</a>( item );
        <a href="qiconview.html#65c0ac">repaintItem</a>( item );
        qApp-&gt;processEvents();
        item-&gt;<a href="qiconviewitem.html#c6b054">rename</a>();
    }
    <a href="qiconview.html#7b3f0b">setAutoArrange</a>( TRUE );
}

<a href="qdir.html">QDir</a> <a name="218"></a>QtFileIconView::currentDir()
{
    return viewDir;
}

static bool isRoot( const QString &amp;s )
{
#if defined(_OS_UNIX_)
    if ( s == "/" )
        return TRUE;
#elif defined(_OS_WIN32_)
    <a href="qstring.html">QString</a> p = s;
    if ( p.<a href="qstring.html#0ecbda">length</a>() == 3 &amp;&amp;
         p.<a href="qstring.html#98b160">right</a>( 2 ) == ":/" )
        return TRUE;
    if ( p[ 0 ] == '/' &amp;&amp; p[ 1 ] == '/' ) {
        int slashes = p.<a href="qstring.html#3c8233">contains</a>( '/' );
        if ( slashes &lt;= 3 )
            return TRUE;
        if ( slashes == 4 &amp;&amp; p[ (int)p.<a href="qstring.html#0ecbda">length</a>() - 1 ] == '/' )
            return TRUE;
    }
#endif

    return FALSE;
}

void <a name="219"></a>QtFileIconView::readDir( const QDir &amp;dir )
{
    if ( !dir.<a href="qdir.html#6dc6f9">isReadable</a>() )
        return;

    if ( isRoot( dir.<a href="qdir.html#bf5f8c">absPath</a>() ) )
        emit disableUp();
    else
        emit enableUp();

    <a href="qiconview.html#f84d65">clear</a>();

    emit directoryChanged( dir.<a href="qdir.html#bf5f8c">absPath</a>() );

    const QFileInfoList *filist = dir.<a href="qdir.html#789222">entryInfoList</a>( QDir::DefaultFilter, QDir::DirsFirst | QDir::Name );

    emit startReadDir( filist-&gt;count() );

    QFileInfoListIterator it( *filist );
    <a href="qfileinfo.html">QFileInfo</a> *fi;
    bool allowRename = FALSE, allowRenameSet = FALSE;
    while ( ( fi = it.current() ) != 0 ) {
        ++it;
        if ( fi &amp;&amp; fi-&gt;<a href="qfileinfo.html#a9e3d2">fileName</a>() == ".." &amp;&amp; ( fi-&gt;<a href="qfileinfo.html#3efc66">dirPath</a>() == "/" || fi-&gt;<a href="qfileinfo.html#3efc66">dirPath</a>().isEmpty() ) )
            continue;
        emit readNextDir();
        QtFileIconViewItem *item = new QtFileIconViewItem( this, new <a href="qfileinfo.html">QFileInfo</a>( *fi ) );
        if ( fi-&gt;<a href="qfileinfo.html#70e102">isDir</a>() )
            item-&gt;<a href="qiconviewitem.html#4782f9">setKey</a>( <a href="qstring.html">QString</a>( "000000%1" ).arg( fi-&gt;<a href="qfileinfo.html#a9e3d2">fileName</a>() ) );
        else
            item-&gt;<a href="qiconviewitem.html#4782f9">setKey</a>( fi-&gt;<a href="qfileinfo.html#a9e3d2">fileName</a>() );
        if ( !allowRenameSet ) {
            if ( !QFileInfo( fi-&gt;<a href="qfileinfo.html#b8684f">absFilePath</a>() ).isWritable() ||
                 item-&gt;<a href="qiconviewitem.html#3715d1">text</a>() == "." || item-&gt;<a href="qiconviewitem.html#3715d1">text</a>() == ".." )
                allowRename = FALSE;
            else
                allowRename = TRUE;
            if ( item-&gt;<a href="qiconviewitem.html#3715d1">text</a>() == "." || item-&gt;<a href="qiconviewitem.html#3715d1">text</a>() == ".." )
                allowRenameSet = FALSE;
            else
                allowRenameSet = TRUE;
        }
        item-&gt;<a href="qiconviewitem.html#2eb423">setRenameEnabled</a>( allowRename );
    }

    if ( !QFileInfo( dir.<a href="qdir.html#bf5f8c">absPath</a>() ).isWritable() )
        emit disableMkdir();
    else
        emit enableMkdir();

    emit readDirDone();
}

void <a name="220"></a>QtFileIconView::itemDoubleClicked( <a href="qiconviewitem.html">QIconViewItem</a> *i )
{
    QtFileIconViewItem *item = ( QtFileIconViewItem* )i;

    if ( item-&gt;type() == QtFileIconViewItem::Dir ) {
        viewDir = QDir( item-&gt;filename() );
        <a href=#219>readDir</a>( viewDir );
    } else if ( item-&gt;type() == QtFileIconViewItem::Link &amp;&amp;
                <a href="qfileinfo.html">QFileInfo</a>( <a href="qfileinfo.html">QFileInfo</a>( item-&gt;filename() ).readLink() ).isDir() ) {
        viewDir = QDir( <a href="qfileinfo.html">QFileInfo</a>( item-&gt;filename() ).readLink() );
        <a href=#219>readDir</a>( viewDir );
    }
}

<a href="qdragobject.html">QDragObject</a> *<a name="221"></a>QtFileIconView::dragObject()
{
    if ( !currentItem() )
        return 0;

    <a href="qpoint.html">QPoint</a> orig = viewportToContents( <a href="qscrollview.html#26f2bf">viewport</a>()-&gt;mapFromGlobal( <a href="qcursor.html#5bce2b">QCursor::pos</a>() ) );
    QtFileIconDrag *drag = new QtFileIconDrag( <a href="qscrollview.html#26f2bf">viewport</a>() );
    drag-&gt;<a href="qdragobject.html#790b96">setPixmap</a>( *currentItem()-&gt;pixmap(),
                     <a href="qpoint.html">QPoint</a>( <a href="qiconview.html#b2a5c7">currentItem</a>()-&gt;pixmapRect().width() / 2, <a href="qiconview.html#b2a5c7">currentItem</a>()-&gt;pixmapRect().height() / 2 ) );
    for ( QtFileIconViewItem *item = (QtFileIconViewItem*)firstItem(); item;
          item = (QtFileIconViewItem*)item-&gt;<a href="qiconviewitem.html#005b99">nextItem</a>() ) {
        if ( item-&gt;<a href="qiconviewitem.html#8fd9c9">isSelected</a>() ) {
            <a href="qicondragitem.html">QIconDragItem</a> id;
            id.<a href="qicondragitem.html#89eea4">setData</a>( <a href="qcstring.html">QCString</a>( item-&gt;filename() ) );
            drag-&gt;<a href="qicondrag.html#e2f3cc">append</a>( id,
                          <a href="qrect.html">QRect</a>( item-&gt;<a href="qiconviewitem.html#a9db94">pixmapRect</a>( FALSE ).x() - orig.<a href="qpoint.html#7e96b2">x</a>(),
                                 item-&gt;<a href="qiconviewitem.html#a9db94">pixmapRect</a>( FALSE ).y() - orig.<a href="qpoint.html#e48824">y</a>(),
                                 item-&gt;<a href="qiconviewitem.html#a9db94">pixmapRect</a>().width(), item-&gt;<a href="qiconviewitem.html#a9db94">pixmapRect</a>().height() ),
                          <a href="qrect.html">QRect</a>( item-&gt;<a href="qiconviewitem.html#09025a">textRect</a>( FALSE ).x() - orig.<a href="qpoint.html#7e96b2">x</a>(),
                                 item-&gt;<a href="qiconviewitem.html#09025a">textRect</a>( FALSE ).y() - orig.<a href="qpoint.html#e48824">y</a>(),
                                 item-&gt;<a href="qiconviewitem.html#09025a">textRect</a>().width(), item-&gt;<a href="qiconviewitem.html#09025a">textRect</a>().height() ),
                          <a href="qstring.html">QString</a>( item-&gt;filename() ) );
        }
    }

    return drag;
}

void <a name="222"></a>QtFileIconView::keyPressEvent( <a href="qkeyevent.html">QKeyEvent</a> *e )
{
    if ( e-&gt;key() == Key_N &amp;&amp;
         ( e-&gt;state() &amp; ControlButton ) )
        <a href=#217>newDirectory</a>();
    else
        <a href="qiconview.html#c1b24e">QIconView::keyPressEvent</a>( e );
}

void <a name="223"></a>QtFileIconView::slotDropped( <a href="qdropevent.html">QDropEvent</a> *e, const QValueList&lt;<a href="qicondragitem.html">QIconDragItem</a>&gt; &amp; )
{
    if ( openItem )
        openItem-&gt;timer.stop();
    if ( !QUriDrag::canDecode( e ) ) {
        e-&gt;<a href="qdropevent.html#e7a50f">ignore</a>();
        return;
    }

    <a href="qstrlist.html">QStrList</a> lst;
    <a href="quridrag.html#e14cb1">QUriDrag::decode</a>( e, lst );

    <a href="qstring.html">QString</a> str;
    if ( e-&gt;<a href="qdropevent.html#d9f8b7">action</a>() == QDropEvent::Copy )
        str = "Copy\n\n";
    else
        str = "Move\n\n";
    for ( uint i = 0; i &lt; lst.<a href="qlist.html#359d9f">count</a>(); ++i )
        str += QString( "   %1\n" ).arg( lst.<a href="qlist.html#1cdd9a">at</a>( i ) );
    str += QString( "\n"
                    "To\n\n"
                    "   %1" ).arg( viewDir.absPath() );

    <a href="qmessagebox.html#66b7c8">QMessageBox::information</a>( this, e-&gt;<a href="qdropevent.html#d9f8b7">action</a>() == QDropEvent::Copy ? "Copy" : "Move" , str, "Not Implemented" );
    if ( e-&gt;<a href="qdropevent.html#d9f8b7">action</a>() == QDropEvent::Move )
        <a href="qmessagebox.html#66b7c8">QMessageBox::information</a>( this, "Remove" , str, "Not Implemented" );
    e-&gt;<a href="qdropevent.html#d37a0e">acceptAction</a>();
    openItem = 0;
}

void <a name="224"></a>QtFileIconView::viewLarge()
{
    <a href=#235>setViewMode</a>( Large );
}

void <a name="225"></a>QtFileIconView::viewSmall()
{
    <a href=#235>setViewMode</a>( Small );
}

void <a name="226"></a>QtFileIconView::viewBottom()
{
    <a href="qiconview.html#a495e8">setItemTextPos</a>( Bottom );
}

void <a name="227"></a>QtFileIconView::viewRight()
{
    <a href="qiconview.html#a495e8">setItemTextPos</a>( Right );
}

void <a name="228"></a>QtFileIconView::flowEast()
{
    <a href="qscrollview.html#aaf795">setHScrollBarMode</a>( AlwaysOff );
    <a href="qscrollview.html#817b47">setVScrollBarMode</a>( Auto );
    <a href="qiconview.html#bf383b">setArrangement</a>( LeftToRight );
}

void <a name="229"></a>QtFileIconView::flowSouth()
{
    <a href="qscrollview.html#817b47">setVScrollBarMode</a>( AlwaysOff );
    <a href="qscrollview.html#aaf795">setHScrollBarMode</a>( Auto );
    <a href="qiconview.html#bf383b">setArrangement</a>( TopToBottom );
}

void <a name="230"></a>QtFileIconView::sortAscending()
{
    <a href="qiconview.html#7be9a1">sort</a>( TRUE );
}

void <a name="231"></a>QtFileIconView::sortDescending()
{
    <a href="qiconview.html#7be9a1">sort</a>( FALSE );
}

void <a name="232"></a>QtFileIconView::itemTextTruncate()
{
    <a href="qiconview.html#dbeaa6">setWordWrapIconText</a>( FALSE );
}

void <a name="233"></a>QtFileIconView::itemTextWordWrap()
{
    <a href="qiconview.html#dbeaa6">setWordWrapIconText</a>( TRUE );
}

void <a name="234"></a>QtFileIconView::slotRightPressed( <a href="qiconviewitem.html">QIconViewItem</a> *item )
{
    if ( !item ) { // right pressed on viewport
        <a href="qpopupmenu.html">QPopupMenu</a> menu( this );

        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "&amp;Large view", this, SLOT( <a href=#224>viewLarge</a>() ) );
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "&amp;Small view", this, SLOT( <a href=#225>viewSmall</a>() ) );
        menu.<a href="qmenudata.html#e34b79">insertSeparator</a>();
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Text at the &amp;bottom", this, SLOT( <a href=#226>viewBottom</a>() ) );
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Text at the &amp;right", this, SLOT( <a href=#227>viewRight</a>() ) );
        menu.<a href="qmenudata.html#e34b79">insertSeparator</a>();
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Arrange l&amp;eft to right", this, SLOT( <a href=#228>flowEast</a>() ) );
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Arrange t&amp;op to bottom", this, SLOT( <a href=#229>flowSouth</a>() ) );
        menu.<a href="qmenudata.html#e34b79">insertSeparator</a>();
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "&amp;Truncate item text", this, SLOT( <a href=#232>itemTextTruncate</a>() ) );
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "&amp;Wordwrap item text", this, SLOT( <a href=#233>itemTextWordWrap</a>() ) );
        menu.<a href="qmenudata.html#e34b79">insertSeparator</a>();
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Arrange items in &amp;grid", this, SLOT( <a href="qiconview.html#9fb7be">arrangeItemsInGrid</a>() ) );
        menu.<a href="qmenudata.html#e34b79">insertSeparator</a>();
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Sort &amp;ascending", this, SLOT( <a href=#230>sortAscending</a>() ) );
        menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Sort &amp;descending", this, SLOT( <a href=#231>sortDescending</a>() ) );

        menu.<a href="qwidget.html#36406c">setMouseTracking</a>( TRUE );
        menu.<a href="qpopupmenu.html#ac4d90">exec</a>( <a href="qcursor.html#5bce2b">QCursor::pos</a>() );
    } else { // on item
        <a href="qpopupmenu.html">QPopupMenu</a> menu( this );

        int RENAME_ITEM = menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Rename Item" );
        int REMOVE_ITEM = menu.<a href="qmenudata.html#0076cb">insertItem</a>( "Remove Item" );

        menu.<a href="qwidget.html#36406c">setMouseTracking</a>( TRUE );
        int id = menu.<a href="qpopupmenu.html#ac4d90">exec</a>( <a href="qcursor.html#5bce2b">QCursor::pos</a>() );

        if ( id == -1 )
            return;

        if ( id == RENAME_ITEM &amp;&amp; item-&gt;<a href="qiconviewitem.html#ec7f4e">renameEnabled</a>() ) {
            item-&gt;<a href="qiconviewitem.html#c6b054">rename</a>();
        } else if ( id == REMOVE_ITEM ) {
            delete item;
            <a href="qmessagebox.html#66b7c8">QMessageBox::information</a>( this, "Not implemented!", "Deleting files not implemented yet,\n"
                                      "The item has only been removed from the view! " );
        }
    }
}

void <a name="235"></a>QtFileIconView::setViewMode( ViewMode m )
{
    if ( m == vm )
        return;

    vm = m;
    QtFileIconViewItem *item = (QtFileIconViewItem*)firstItem();
    for ( ; item; item = (QtFileIconViewItem*)item-&gt;<a href="qiconviewitem.html#005b99">nextItem</a>() )
        item-&gt;viewModeChanged( vm );

    <a href="qiconview.html#9fb7be">arrangeItemsInGrid</a>();
}
</pre>


  <hr>

  Header file of the mainwindow: <pre>/****************************************************************************
** &#36;Id&#58; qt/examples/fileiconview/mainwindow.h   2.3.2   edited 2001-01-26 $
**
** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.
**
** This file is part of an example program for Qt.  This example
** program may be used, distributed and modified without limitation.
**
*****************************************************************************/

#ifndef MAINWIN_H
#define MAINWIN_H

#include &lt;<a href="qmainwindow-h.html">qmainwindow.h</a>&gt;

class QtFileIconView;
class DirectoryView;
class QProgressBar;
class QLabel;
class QComboBox;
class QToolButton;

class FileMainWindow : public QMainWindow
{
    Q_OBJECT

public:
    FileMainWindow();

    QtFileIconView *fileView() { return fileview; }
    DirectoryView *dirList() { return dirlist; }

    void show();

protected:
    void setup();
    void setPathCombo();

    QtFileIconView *fileview;
    DirectoryView *dirlist;
    <a href="qprogressbar.html">QProgressBar</a> *progress;
    <a href="qlabel.html">QLabel</a> *label;
    <a href="qcombobox.html">QComboBox</a> *pathCombo;
    <a href="qtoolbutton.html">QToolButton</a> *upButton, *mkdirButton;

protected slots:
    void directoryChanged( const QString &amp; );
    void slotStartReadDir( int dirs );
    void slotReadNextDir();
    void slotReadDirDone();
    void cdUp();
    void newFolder();
    void changePath( const QString &amp;path );
    void enableUp();
    void disableUp();
    void enableMkdir();
    void disableMkdir();

};

#endif
</pre>


  <hr>

  Implementation of the mainwindow: <pre>/****************************************************************************
** &#36;Id&#58; qt/examples/fileiconview/mainwindow.cpp   2.3.2   edited 2001-01-26 $
**
** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.
**
** This file is part of an example program for Qt.  This example
** program may be used, distributed and modified without limitation.
**
*****************************************************************************/

#include "mainwindow.h"
#include "qfileiconview.h"
#include "../dirview/dirview.h"

#include &lt;<a href="qsplitter-h.html">qsplitter.h</a>&gt;
#include &lt;<a href="qprogressbar-h.html">qprogressbar.h</a>&gt;
#include &lt;<a href="qlabel-h.html">qlabel.h</a>&gt;
#include &lt;<a href="qstatusbar-h.html">qstatusbar.h</a>&gt;
#include &lt;<a href="qtoolbar-h.html">qtoolbar.h</a>&gt;
#include &lt;<a href="qcombobox-h.html">qcombobox.h</a>&gt;
#include &lt;<a href="qpixmap-h.html">qpixmap.h</a>&gt;
#include &lt;<a href="qtoolbutton-h.html">qtoolbutton.h</a>&gt;
#include &lt;<a href="qdir-h.html">qdir.h</a>&gt;
#include &lt;<a href="qfileinfo-h.html">qfileinfo.h</a>&gt;

static const char* cdtoparent_xpm[]={
    "15 13 3 1",
    ". c None",
    "* c #000000",
    "a c #ffff99",
    "..*****........",
    ".*aaaaa*.......",
    "***************",
    "*aaaaaaaaaaaaa*",
    "*aaaa*aaaaaaaa*",
    "*aaa***aaaaaaa*",
    "*aa*****aaaaaa*",
    "*aaaa*aaaaaaaa*",
    "*aaaa*aaaaaaaa*",
    "*aaaa******aaa*",
    "*aaaaaaaaaaaaa*",
    "*aaaaaaaaaaaaa*",
    "***************"};

static const char* newfolder_xpm[] = {
    "15 14 4 1",
    "   c None",
    ".  c #000000",
    "+  c #FFFF00",
    "@  c #FFFFFF",
    "          .    ",
    "               ",
    "          .    ",
    "       .     . ",
    "  ....  . . .  ",
    " .+@+@.  . .   ",
    "..........  . .",
    ".@+@+@+@+@..   ",
    ".+@+@+@+@+. .  ",
    ".@+@+@+@+@.  . ",
    ".+@+@+@+@+.    ",
    ".@+@+@+@+@.    ",
    ".+@+@+@+@+.    ",
    "...........    "};

FileMainWindow::FileMainWindow()
    : <a href="qmainwindow.html">QMainWindow</a>()
{
    <a href=#241>setup</a>();
}

void <a name="240"></a>FileMainWindow::show()
{
    <a href="qmainwindow.html#eb53e3">QMainWindow::show</a>();
}

void <a name="241"></a>FileMainWindow::setup()
{
    <a href="qsplitter.html">QSplitter</a> *splitter = new <a href="qsplitter.html">QSplitter</a>( this );

    dirlist = new DirectoryView( splitter, "dirlist", TRUE );
    dirlist-&gt;addColumn( "Name" );
    dirlist-&gt;addColumn( "Type" );
    Directory *root = new Directory( dirlist, "/" );
    root-&gt;<a href="qlistviewitem.html#1c5a28">setOpen</a>( TRUE );
    splitter-&gt;<a href="qsplitter.html#33bf83">setResizeMode</a>( dirlist, QSplitter::KeepSize );

    fileview = new QtFileIconView( "/", splitter );
    fileview-&gt;setSelectionMode( QIconView::Extended );

    <a href="qmainwindow.html#fce9ba">setCentralWidget</a>( splitter );

    <a href="qtoolbar.html">QToolBar</a> *toolbar = new <a href="qtoolbar.html">QToolBar</a>( this, "toolbar" );
    <a href="qmainwindow.html#edcb2d">setRightJustification</a>( TRUE );

    (void)new <a href="qlabel.html">QLabel</a>( <a href="qobject.html#2418a9">tr</a>( " Path: " ), toolbar );

    pathCombo = new <a href="qcombobox.html">QComboBox</a>( TRUE, toolbar );
    pathCombo-&gt;setAutoCompletion( TRUE );
    toolbar-&gt;<a href="qtoolbar.html#7b948e">setStretchableWidget</a>( pathCombo );
    <a href="qobject.html#7f8e37">connect</a>( pathCombo, SIGNAL( activated( const QString &amp; ) ),
             this, SLOT ( <a href=#249>changePath</a>( const QString &amp; ) ) );

    toolbar-&gt;<a href="qtoolbar.html#af219d">addSeparator</a>();

    <a href="qpixmap.html">QPixmap</a> pix;

    pix = QPixmap( cdtoparent_xpm );
    upButton = new <a href="qtoolbutton.html">QToolButton</a>( pix, "One directory up", QString::null,
                                this, SLOT( <a href=#247>cdUp</a>() ), toolbar, "cd up" );

    pix = QPixmap( newfolder_xpm );
    mkdirButton = new <a href="qtoolbutton.html">QToolButton</a>( pix, "New Folder", QString::null,
                                   this, SLOT( <a href=#248>newFolder</a>() ), toolbar, "new folder" );

    <a href="qobject.html#7f8e37">connect</a>( dirlist, SIGNAL( folderSelected( const QString &amp; ) ),
             fileview, SLOT ( setDirectory( const QString &amp; ) ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( <a href=#243>directoryChanged</a>( const QString &amp; ) ),
             this, SLOT( <a href=#243>directoryChanged</a>( const QString &amp; ) ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( startReadDir( int ) ),
             this, SLOT( <a href=#244>slotStartReadDir</a>( int ) ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( readNextDir() ),
             this, SLOT( <a href=#245>slotReadNextDir</a>() ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( readDirDone() ),
             this, SLOT( <a href=#246>slotReadDirDone</a>() ) );

    <a href="qmainwindow.html#712cb8">setDockEnabled</a>( Left, FALSE );
    <a href="qmainwindow.html#712cb8">setDockEnabled</a>( Right, FALSE );

    label = new <a href="qlabel.html">QLabel</a>( <a href="qmainwindow.html#530937">statusBar</a>() );
    <a href="qmainwindow.html#530937">statusBar</a>()-&gt;addWidget( label, 2, TRUE );
    progress = new <a href="qprogressbar.html">QProgressBar</a>( <a href="qmainwindow.html#530937">statusBar</a>() );
    <a href="qmainwindow.html#530937">statusBar</a>()-&gt;addWidget( progress, 1, TRUE );

    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( <a href=#250>enableUp</a>() ),
             this, SLOT( <a href=#250>enableUp</a>() ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( <a href=#251>disableUp</a>() ),
             this, SLOT( <a href=#251>disableUp</a>() ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( <a href=#252>enableMkdir</a>() ),
             this, SLOT( <a href=#252>enableMkdir</a>() ) );
    <a href="qobject.html#7f8e37">connect</a>( fileview, SIGNAL( <a href=#253>disableMkdir</a>() ),
             this, SLOT( <a href=#253>disableMkdir</a>() ) );
}

void <a name="242"></a>FileMainWindow::setPathCombo()
{
    <a href="qstring.html">QString</a> dir = caption();
    int i = 0;
    bool found = FALSE;
    for ( i = 0; i &lt; pathCombo-&gt;count(); ++i ) {
        if ( pathCombo-&gt;text( i ) == dir) {
            found = TRUE;
            break;
        }
    }

    if ( found )
        pathCombo-&gt;setCurrentItem( i );
    else {
        pathCombo-&gt;insertItem( dir );
        pathCombo-&gt;setCurrentItem( pathCombo-&gt;count() - 1 );
    }

}

void <a name="243"></a>FileMainWindow::directoryChanged( const QString &amp;dir )
{
    <a href="qwidget.html#d6a291">setCaption</a>( dir );
    <a href=#242>setPathCombo</a>();
}

void <a name="244"></a>FileMainWindow::slotStartReadDir( int dirs )
{
    label-&gt;setText( <a href="qobject.html#2418a9">tr</a>( " Reading Directory..." ) );
    progress-&gt;reset();
    progress-&gt;setTotalSteps( dirs );
}

void <a name="245"></a>FileMainWindow::slotReadNextDir()
{
    int p = progress-&gt;progress();
    progress-&gt;setProgress( ++p );
}

void <a name="246"></a>FileMainWindow::slotReadDirDone()
{
    label-&gt;setText( <a href="qobject.html#2418a9">tr</a>( " Reading Directory Done." ) );
    progress-&gt;setProgress( progress-&gt;totalSteps() );
}

void <a name="247"></a>FileMainWindow::cdUp()
{
    <a href="qdir.html">QDir</a> dir = fileview-&gt;currentDir();
    dir.<a href="qdir.html#f0fc10">cd</a>( ".." );
    fileview-&gt;setDirectory( dir );
}

void <a name="248"></a>FileMainWindow::newFolder()
{
    fileview-&gt;newDirectory();
}

void <a name="249"></a>FileMainWindow::changePath( const QString &amp;path )
{
    if ( <a href="qfileinfo.html">QFileInfo</a>( path ).exists() )
        fileview-&gt;setDirectory( path );
    else
        <a href=#242>setPathCombo</a>();
}

void <a name="250"></a>FileMainWindow::enableUp()
{
    upButton-&gt;setEnabled( TRUE );
}

void <a name="251"></a>FileMainWindow::disableUp()
{
    upButton-&gt;setEnabled( FALSE );
}

void <a name="252"></a>FileMainWindow::enableMkdir()
{
    mkdirButton-&gt;setEnabled( TRUE );
}

void <a name="253"></a>FileMainWindow::disableMkdir()
{
    mkdirButton-&gt;setEnabled( FALSE );
}
</pre>


  <hr>

  Main:
<pre>/****************************************************************************
** &#36;Id&#58; qt/examples/fileiconview/main.cpp   2.3.2   edited 2001-01-26 $
**
** Copyright (C) 1992-2000 Trolltech AS.  All rights reserved.
**
** This file is part of an example program for Qt.  This example
** program may be used, distributed and modified without limitation.
**
*****************************************************************************/

#include "mainwindow.h"
#include "qfileiconview.h"

#include &lt;<a name="qapplication.h"></a><a href="qapplication-h.html">qapplication.h</a>&gt;

int main( int argc, char **argv )
{
    <a name="QApplication"></a><a href="qapplication.html">QApplication</a> a( argc, argv );

    FileMainWindow mw;
    mw.<a name="resize"></a><a href="qwidget.html#ff9d07">resize</a>( 680, 480 );
    a.<a name="setMainWidget"></a><a href="qapplication.html#7ad759">setMainWidget</a>( &amp;mw );
    mw.fileView()-&gt;setDirectory( "/" );
    mw.<a name="show"></a><a href="qmainwindow.html#eb53e3">show</a>();
    return a.<a name="exec"></a><a href="qapplication.html#84c7bf">exec</a>();
}
</pre>
<p><address><hr><div align="center">
<table width="100%" cellspacing="0" border="0"><tr>
<td>Copyright © 2001 Trolltech<td><a href="http://www.trolltech.com/trademarks.html">Trademarks</a>
<td align="right"><div align="right">Qt version 2.3.2</div>
</table></div></address></body></html>
